<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SearchBarbara</title>
  <link rel="stylesheet" href="/static/styles_v2.css" />
</head>
<body>
  <div class="app-shell">
    <header class="topbar">
      <div>
        <h1>SearchBarbara</h1>
        <p class="subtitle">Thinking-partner mode</p>
      </div>
      <div class="top-metrics">
        <div><span class="k">Run</span><span id="runStatus">idle</span></div>
        <div><span class="k">Research</span><span id="researchStatus">idle</span></div>
        <div><span class="k">Report</span><span id="reportStatus">pending</span></div>
        <div><span class="k">Tokens</span><span id="tokenSummary">-</span></div>
      </div>
    </header>

    <section class="session-dock card">
      <div class="section-head">
        <h2>Sessions</h2>
        <div class="dock-controls">
          <button id="newSessionBtn" type="button">New Session</button>
          <button id="refreshSessionsBtn" type="button">Refresh</button>
        </div>
      </div>
      <div id="sessionList" class="session-list"></div>
    </section>

    <section class="prompt-dock card">
      <label for="task" class="dock-label">Research Task</label>
      <textarea id="task" rows="3" placeholder="Ask a deep research question..."></textarea>
      <div class="dock-controls">
        <button id="runBtn" class="primary">Start Research</button>
        <button id="reportBtn" disabled>Generate Report From Current Findings</button>
        <button id="downloadBtn" disabled>Download Report</button>
      </div>
      <details>
        <summary>Advanced controls</summary>
        <div class="dock-controls">
          <button id="pauseBtn" type="button" disabled>Pause Research</button>
          <button id="resumeBtn" type="button" disabled>Resume Research</button>
          <button id="abortBtn" type="button" disabled>Abort Research</button>
        </div>
        <div class="advanced-grid">
          <label>Max depth <input id="maxDepth" type="number" value="{{ default_max_depth }}" min="{{ max_depth_min }}" max="{{ max_depth_max }}"></label>
          <label>Results/query <input id="resultsPerQuery" type="number" value="{{ default_results_per_query }}" min="{{ results_per_query_min }}" max="{{ results_per_query_max }}"></label>
        </div>
      </details>
      <div id="runMeta" class="muted"></div>
      <div id="stopReason" class="stop-reason"></div>
      <div id="errorBanner" class="error hidden" aria-live="polite"></div>
    </section>

    <section class="context card">
      <div class="section-head">
        <h2>Context</h2>
        <div class="context-head-tools">
          <span id="contextMeta" class="muted">No session selected.</span>
        </div>
      </div>
      <div class="context-controls">
        <input id="contextUploadInput" type="file" multiple />
        <button id="contextUploadBtn" type="button" disabled>Upload Files</button>
      </div>
      <div id="contextDiffBanner" class="muted"></div>
      <div class="context-grid">
        <div class="context-files-pane">
          <h3>Files</h3>
          <div id="contextFiles" class="context-files-list"></div>
        </div>
        <div class="context-digest-pane">
          <h3>Aggregate Digest</h3>
          <pre id="contextAggregateDigest" class="usage"></pre>
        </div>
      </div>
    </section>

    <main class="content-grid">
      <section class="canvas card">
        <div class="section-head">
          <h2>Research Canvas</h2>
          <div class="canvas-toolbar">
            <span id="canvasHint" class="muted">Auto-fit</span>
            <button id="zoomOutBtn" type="button">-</button>
            <span id="zoomPct" class="zoom-pct">100%</span>
            <button id="zoomInBtn" type="button">+</button>
            <button id="zoomFitBtn" type="button">Fit</button>
            <span id="fitDebug" class="zoom-debug muted"></span>
          </div>
        </div>
        <div id="canvas" class="canvas-board"></div>
      </section>

      <section class="thoughts card" aria-live="polite">
        <div class="section-head">
          <h2>Thought Stream</h2>
          <span id="latestThought" class="muted"></span>
        </div>
        <div id="thoughtStream" class="thought-list"></div>
      </section>

      <section class="report card">
        <div class="section-head">
          <h2>Report</h2>
          <div class="report-head-tools">
            <button id="reportPrevBtn" type="button" disabled>&lt;</button>
            <span id="reportVersionLabel" class="muted">-/-</span>
            <button id="reportNextBtn" type="button" disabled>&gt;</button>
            <label class="raw-toggle"><input id="rawToggle" type="checkbox" /> Raw</label>
          </div>
        </div>
        <div id="coverageNote" class="muted"></div>
        <pre id="reportRaw" class="report-body hidden"></pre>
        <div id="reportRendered" class="report-body rendered"></div>
        <h3>Token Usage</h3>
        <pre id="usage" class="usage"></pre>
      </section>
    </main>
  </div>
  <script>
    window.APP_CONFIG = {
      min_canvas_zoom: {{ min_canvas_zoom|tojson }},
      auto_fit_safety_px: {{ auto_fit_safety_px|tojson }},
      default_max_depth: {{ default_max_depth|tojson }},
      default_results_per_query: {{ default_results_per_query|tojson }},
      ui_debug: {{ ui_debug|tojson }},
    };
  </script>
  <script src="/static/app_v2.js"></script>
</body>
</html>
